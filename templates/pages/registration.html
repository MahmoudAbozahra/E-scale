{% extends "base.html" %}
{% load static %}
{% block content %}




<div class="container-fluid mt-4">
  <form method="post">
    {% csrf_token %}
    <div class="row">

      <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
      <div class="col-md-3" style="text-align: right;">
        <div class="card shadow sticky-top" style="top: 20px;">
          <div class="card-body">
            <h5 class="card-title">ğŸ“‹Ø§Ù„ØªØ°ÙƒØ±Ø©</h5>
            {{ bird_form.as_p }}
            <button type="submit" name="print_ticket" class="btn btn-success w-100">Ø­ÙØ¸ Ø§Ù„ØªØ°ÙƒØ±Ø©</button>
          </div>
        </div>
      </div>

      <!-- Ø§Ù„ÙÙˆØ±Ù…Ø§Øª -->
      <div class="col-md-9" style="text-align: right;">
        <div class="card shadow mb-4">
          <div class="card-body">
            <div class="row g-4">

              <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
              <div class="col-md-6">
                <div class="card border-primary h-100">
                  <div class="card-header bg-primary text-white">ğŸ‘¤ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
                  <div class="card-body">
                    {{ clint_form.as_p }}
                  </div>
                </div>
              </div>

              <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
              <div class="col-md-6">
                <div class="card border-primary h-100">
                  <div class="card-header bg-primary text-white">ğŸš— Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</div>
                  <div class="card-body">
                    {{ car_form.as_p|safe }}
                  </div>
                </div>
              </div>
              
              <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ÙˆØ²Ù† -->
              <div class="col-12">
                <div class="card border-primary h-100">
                  <div class="card-header bg-primary text-white">âš–ï¸ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ÙˆØ²Ù†</div>
                  <div class="card-body">
                    {{ scale_form.as_p }}
                    <button type="button" id="copy-weight-btn" class="btn btn-success w-10">Ù†Ø³Ø® Ø§Ù„ÙˆØ²Ù†</button>
                  </div>
                </div>
              </div>

            </div> <!-- /row -->
          </div> <!-- /card-body -->
        </div> <!-- /card -->
      </div> <!-- /col -->

    </div> <!-- /row -->
  </form> <!-- form ÙˆØ§Ø­Ø¯Ø© Ù‡Ù†Ø§ -->

</div> <!-- /container -->


<script>
  const weightInput = document.getElementById('weight-input');
  const carWeightInput = document.getElementById('first_wieght');
  const ticketWeightInput = document.getElementById('ticket_weight');
  const copyBtn = document.getElementById('copy-weight-btn');
  const timeDiv = document.getElementById('weight-added-time');
  const timeInput = document.getElementById('sample_time'); 

  let socket = new WebSocket('ws://' + window.location.host + '/ws/scale/');

  socket.onmessage = function(event) {
    const data = JSON.parse(event.data);
    if (data.weight !== undefined && weightInput) {
      weightInput.value = data.weight;
    }
  };

copyBtn.addEventListener('click', () => {
  if (weightInput && carWeightInput && ticketWeightInput && timeInput) {
    carWeightInput.value = weightInput.value;
    ticketWeightInput.value = weightInput.value;

    const now = new Date();
    const formattedDate = now.toLocaleString('ar-EG', { hour12: true });

    timeInput.value = formattedDate;  // âœ¨ Ø­Ø·ÙŠÙ†Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙÙŠ Ø§Ù„Ù…Ø±Ø¨Ø¹
    socket.close();
  } else {
    alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.');
  }
});
  // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©ØŒ ØªÙØªØ­ WebSocket Ù…Ù† Ø¬Ø¯ÙŠØ¯ (ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)
</script>



{% endblock %}
